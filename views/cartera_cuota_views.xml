<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- VISTA LISTA DE CUOTAS -->
    <record id="view_cartera_cuota_tree" model="ir.ui.view">
        <field name="name">cartera.cuota.tree</field>
        <field name="model">cartera.cuota</field>
        <field name="arch" type="xml">
            <list string="Cuotas" 
                  decoration-danger="estado=='vencida'"
                  decoration-success="estado=='pagada'"
                  decoration-warning="estado=='parcial'">
                <field name="credito_id"/>
                <field name="socio_id"/>
                <field name="numero_cuota"/>
                <field name="fecha_vencimiento"/>
                <field name="monto_capital" sum="Total Capital"/>
                <field name="monto_interes" sum="Total Interés"/>
                <field name="monto_total" sum="Total"/>
                <field name="monto_pagado" sum="Total Pagado"/>
                <field name="saldo_pendiente" sum="Saldo Pendiente"/>
                <field name="dias_vencido"/>
                <field name="estado" 
                       decoration-bf="1"
                       widget="badge"
                       decoration-danger="estado=='vencida'"
                       decoration-success="estado=='pagada'"
                       decoration-warning="estado=='parcial'"
                       decoration-info="estado=='pendiente'"/>
                <button name="action_registrar_pago" 
                        string="Pagar" 
                        type="object"
                        icon="fa-money"
                        invisible="estado=='pagada'"/>
            </list>
        </field>
    </record>

    <!-- VISTA FORM DE CUOTA -->
    <record id="view_cartera_cuota_form" model="ir.ui.view">
        <field name="name">cartera.cuota.form</field>
        <field name="model">cartera.cuota</field>
        <field name="arch" type="xml">
            <form string="Cuota">
                <header>
                    <button name="action_registrar_pago" 
                            string="Registrar Pago" 
                            type="object" 
                            class="oe_highlight"
                            invisible="estado=='pagada'"/>
                    <field name="estado" widget="statusbar"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <span>Cuota </span>
                            <field name="numero_cuota" class="oe_inline"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Información General">
                            <field name="credito_id" readonly="1"/>
                            <field name="socio_id" readonly="1"/>
                            <field name="fecha_vencimiento" readonly="1"/>
                        </group>
                        
                        <group string="Estado">
                            <field name="estado" readonly="1"/>
                            <field name="dias_vencido" readonly="1" 
                                   invisible="dias_vencido == 0"
                                   decoration-danger="dias_vencido &gt; 0"
                                   decoration-bf="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Montos de la Cuota">
                            <field name="monto_capital" readonly="1"/>
                            <field name="monto_interes" readonly="1"/>
                            <field name="monto_total" readonly="1"/>
                        </group>
                        
                        <group string="Saldos">
                            <field name="saldo_inicial" readonly="1"/>
                            <field name="saldo_final" readonly="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Pagos">
                            <field name="monto_pagado" readonly="1"/>
                            <field name="saldo_pendiente" readonly="1" decoration-bf="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Pagos Realizados" name="pagos">
                            <field name="pago_ids" readonly="1">
                                <list string="Pagos">
                                    <field name="name"/>
                                    <field name="fecha"/>
                                    <field name="monto"/>
                                    <field name="aplicado_a_interes"/>
                                    <field name="aplicado_a_capital"/>
                                    <field name="es_solo_interes" widget="boolean_toggle"/>
                                    <field name="comprobante"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- VISTA KANBAN DE CUOTAS -->
    <record id="view_cartera_cuota_kanban" model="ir.ui.view">
        <field name="name">cartera.cuota.kanban</field>
        <field name="model">cartera.cuota</field>
        <field name="arch" type="xml">
            <kanban default_group_by="estado" class="o_kanban_small_column">
                <field name="numero_cuota"/>
                <field name="credito_id"/>
                <field name="socio_id"/>
                <field name="fecha_vencimiento"/>
                <field name="monto_total"/>
                <field name="saldo_pendiente"/>
                <field name="estado"/>
                <field name="dias_vencido"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="credito_id"/> - Cuota <field name="numero_cuota"/>
                                        </strong>
                                    </div>
                                    <span class="float-end badge" 
                                          t-attf-class="badge-#{record.estado.raw_value == 'vencida' ? 'danger' : record.estado.raw_value == 'pagada' ? 'success' : 'warning'}">
                                        <field name="estado"/>
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="socio_id"/>
                                    <br/>
                                    Vence: <field name="fecha_vencimiento"/>
                                    <br/>
                                    Monto: $<field name="monto_total"/>
                                    <br/>
                                    Pendiente: $<field name="saldo_pendiente"/>
                                    <br/>
                                    <t t-if="record.dias_vencido.raw_value &gt; 0">
                                        <span class="text-danger">
                                            <i class="fa fa-exclamation-triangle"/> 
                                            <field name="dias_vencido"/> días vencido
                                        </span>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- VISTA DE BUSQUEDA -->
    <record id="view_cartera_cuota_search" model="ir.ui.view">
        <field name="name">cartera.cuota.search</field>
        <field name="model">cartera.cuota</field>
        <field name="arch" type="xml">
            <search>
                <field name="credito_id"/>
                <field name="socio_id"/>
                <field name="numero_cuota"/>
            </search>
        </field>
    </record>

    <!-- ACCIONES -->
    <record id="action_cartera_cuota" model="ir.actions.act_window">
        <field name="name">Cuotas</field>
        <field name="res_model">cartera.cuota</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{}</field>
    </record>

    <record id="action_cartera_cuota_pendientes" model="ir.actions.act_window">
        <field name="name">Cuotas Pendientes</field>
        <field name="res_model">cartera.cuota</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="domain">[('estado', 'in', ['pendiente', 'parcial'])]</field>
        <field name="context">{'search_default_pendiente': 1}</field>
    </record>

    <record id="action_cartera_cuota_vencidas" model="ir.actions.act_window">
        <field name="name">Cuotas Vencidas</field>
        <field name="res_model">cartera.cuota</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="domain">[('estado', '=', 'vencida')]</field>
        <field name="context">{'search_default_vencida': 1}</field>
    </record>

</odoo>
